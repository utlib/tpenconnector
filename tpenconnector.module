<?php
/**
 * hook_menu
 */
function tpenconnector_menu() {
  $items['tpenconnector/get_manifest'] = array(
    'title' => 'SharedCanvas manifest',
    'page callback' => 'tpenconnector_get_manifest',
    'access arguments' => array('access content'),
    'type' => MENU_NORMAL_ITEM,
    'file' => 'includes/tpenconnector.inc'
  );

/*  $items['islandora/object/%islandora_object/transcribe/delete'] = array(
    'title' => 'Transcribe with T-PEN',
    'page callback' => 'tpenconnector_delete',
    'page arguments' => array(2),
    'type' => MENU_LOCAL_TASK,
    'access callback' => 'tpenconnector_access',
    'access arguments' => array(2),
    'file' => 'includes/tpenconnector.inc'
  );
*/
  $items['islandora/object/%islandora_object/transcribe'] = array(
    'title' => 'Transcribe with T-PEN',
    'page callback' => 'tpenconnector_get_manifest',
    'page arguments' => array(2),
    'type' => MENU_LOCAL_TASK,
    'access callback' => 'tpenconnector_access',
    'access arguments' => array(2),
    'file' => 'includes/tpenconnector.inc'
  );
    $items['islandora/object/%islandora_object/delete-tpen'] = array(
    'title' => 'Delete T-Pen project',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('tpenconnector_delete',2),
    'access callback' => 'tpenconnector_access',
    'access arguments' => array(2),
    'file' => 'includes/tpenconnector.inc'
  );
  return $items;
}

/**
 * Determines whether or not to show this modules tab.
 *
 * @global object $user
 *
 * @param FedoraObject $fedora_object
 *   A FedoraObject.
 *
 * @return bool
 *   Whether the user has access or not.
 */
function tpenconnector_access($fedora_object) {

  $parent_obj = $fedora_object->relationships->get('info:fedora/fedora-system:def/relations-external#', 'isMemberOfCollection');

  $parent_obj_pid = $parent_obj[0]['object']['value'];

  return in_array('islandora:bookCModel', $fedora_object->models) && ($parent_obj_pid === 'paleography:manuscripts') && user_is_logged_in();
}